import "../../App.css";
import styles from "./home.module.css";
import "@fullcalendar/common/main.css";
import { Calendar } from "@fullcalendar/core";
import dayGridPlugin from "@fullcalendar/daygrid";
import interactionPlugin from "@fullcalendar/interaction";
import { useRef, useEffect, useState } from "react";
import Modal, { useModal } from "../../components/modal/index";
import SeleccionarHorario from "../../components/seleccionarHorarios/seleccionarHorarios.jsx";

function Home() {
  const calendarEl = useRef(null);
  const { open, onClose, onOpen } = useModal();
  const [formData, setFormData] = useState({
    fecha: "",
  });

  const today = new Date();
  const formatDate = (date) => date.toISOString().split("T")[0];
  //calendario
  useEffect(() => {
    const calendar = new Calendar(calendarEl.current, {
      locale: "es",
      selectable: true,
      selectAllow: function (seleccInfo) {
        var startDate = seleccInfo.start;
        today.setHours(0,0,0,0);

        var selectedDate = new Date(startDate)
        selectedDate.setHours(0, 0, 0, 0);

        return selectedDate.getTime() != today.getTime();
      },
      plugins: [dayGridPlugin, interactionPlugin],
      initialView: "dayGridMonth",
      validRange: {
        start: formatDate(today),
      },

      select: function (info) {
        handleSelect(info);
      },
    });
    calendar.render();
  }, []);

  const handleSelect = (info) => {
    setFormData({
      fecha: info.startStr,
    });
    onOpen();
  };

  return (
    <div className="app">
      <div className="home">
        
        {
          //muestra el calendario
        }
        <div className={styles.homeCalendar} ref={calendarEl} />
        <Modal open={open} onClose={onClose}>
          <h2>Agendar</h2>
          <strong>Fecha: {formData.fecha}</strong>
          <SeleccionarHorario />

          
        </Modal>
      </div>
    </div>
  );
}

export default Home;
